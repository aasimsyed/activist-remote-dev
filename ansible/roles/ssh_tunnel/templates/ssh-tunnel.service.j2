[Unit]
Description=Persistent SSH Tunnels
After=network.target

[Service]
User=tunneluser
EnvironmentFile=/etc/ssh/tunnel.env
ExecStart=/usr/bin/autossh -M 0 -N -q \
  -o "ServerAliveInterval 60" \
  -o "ServerAliveCountMax 3" \
  {% for port in tunnel_ports %}
  -L {{ port.local }}:localhost:{{ port.remote }} \
  {% endfor %}
  root@${DROPLET_IP}
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target 